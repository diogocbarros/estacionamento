import { Injectable } from '@angular/core';
import { Platform } from 'ionic-angular';

import { AngularFireDatabase } from 'angularfire2/database';
import { AngularFireAuth } from 'angularfire2/auth';
import firebase from 'firebase';
import { Facebook } from '@ionic-native/facebook';

@Injectable()
export class AuthProvider {
  userProfile: any;
  fireAuth: any;
  constructor(public fb: Facebook, public platform: Platform, public afAuth: AngularFireAuth, public afDB: AngularFireDatabase) {
    this.fireAuth = firebase.auth();
  }

  resetPassword(email: string): any {
    return this.fireAuth.sendPasswordResetEmail(email);
  }

  loginUser(email: string, password: string): any {
    return this.afAuth.auth.signInWithEmailAndPassword(email, password);
  }

  signupUser(email, password, nome, celular) {
    return this.afAuth.auth.createUserWithEmailAndPassword(email, password).then((newUser) => {
      console.log('newUser ' + JSON.stringify(newUser))
      return this.afAuth.auth.signInWithEmailAndPassword(email, password).then((authenticatedUser) => {
        console.log('authenticatedUser ' + JSON.stringify(authenticatedUser))
        let uid = authenticatedUser.user.uid;
        let userObject = {
          uid: uid,
          registeredDate: Date.now(),
          email: email,
          password: password,
          nome: nome,
          celular: celular,
          socialPhotoURL: 'data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABQAAD/4QMxaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzAxNCA3OS4xNTY3OTcsIDIwMTQvMDgvMjAtMDk6NTM6MDIgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkIzQzZBN0VCRjdFODExRTQ4NzdDODNEOEIzNTY4RjQxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkIzQzZBN0VDRjdFODExRTQ4NzdDODNEOEIzNTY4RjQxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QjNDNkE3RTlGN0U4MTFFNDg3N0M4M0Q4QjM1NjhGNDEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QjNDNkE3RUFGN0U4MTFFNDg3N0M4M0Q4QjM1NjhGNDEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAACAgICAgICAgICAwIC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'
        };

        newUser.user.updateProfile({
          displayName: nome,
          photoURL: '',
        });


        return this.afDB.list('userProfile').update(uid, userObject).then(() => true,
          error => {
            throw new Error(error.message)
          }
        )
      }, error => {
        throw new Error(error.message)
      })
    }, error => {
      throw new Error(error.message)
    });
  }

  getUserByUid(uid) {
    return new Promise((resolve, reject) => {
      var userRef = this.userProfile.child(uid);
      userRef.once("value", function (snap) {
        var user = snap.val();
        resolve(user);
      }, function (error) {
        reject(error);
      });
    });
  }


  getCurrentUser() {
    return this.fireAuth;
  }

  logoutUser() {
    return firebase.auth().signOut();
  }

  facebookLogin() {
    return this.fb.login(['email', 'public_profile']).then(res => {

      const facebookCredential = firebase.auth.FacebookAuthProvider.credential(res.authResponse.accessToken);
      return firebase.auth().signInAndRetrieveDataWithCredential(facebookCredential).then(data => {
        this.socialLoginSuccess(data)
      });
    })
  }

  socialLoginSuccess(firebaseData) {

    return this.getUserByUid(firebaseData.user.uid).then(user => {
      let uid = firebaseData.user.uid;
      let { displayName, email, photoURL } = firebaseData.user;

      let userObject = {
        uid: uid,
        registeredDate: Date.now(),
        nome: displayName,
        email: email,
        socialPhotoURL: photoURL,
        password: 'facebook'
      };

      return this.afDB.list('userProfile').update(uid, userObject).then(() => true);

    }, error => {
      console.log('social login firebase error', error);
    });
  }



}
